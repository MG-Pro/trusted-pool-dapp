"use strict";(self.webpackChunktrusted_pool_dapp=self.webpackChunktrusted_pool_dapp||[]).push([[886],{7886:(st,v,s)=>{s.r(v),s.d(v,{PoolsModule:()=>et});var r=s(6895),d=s(4006),_=s(4581),f=s(3646),x=s(5019),A=s(5981),T=s(9527),u=s(9383),l=s(5861),g=s(8029),b=s(8505),Z=s(4004),m=s(9300),k=s(1135),L=s(7579),w=s(590),J=s(9841),y=s(1884),U=s(2722),t=s(4650),h=s(4976);function I(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"button",3),t.NdJ("click",function(){t.CHM(n);const a=t.oxw();return t.KtG(a.onAddParticipants())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("disabled",!n.isCreator),t.xp6(1),t.hij(" ",t.lcZ(2,2,"Add participants"),"\n")}}function S(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"button",4),t.NdJ("click",function(){t.CHM(n);const a=t.oxw();return t.KtG(a.onFinalizePool())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("disabled",!n.isCreator),t.xp6(1),t.hij(" ",t.lcZ(2,2,"Finalize"),"\n")}}let N=(()=>{class e{constructor(){this.finalize=new t.vpe,this.addParticipants=new t.vpe}onFinalizePool(){this.finalize.emit(this.activePool)}onAddParticipants(){this.addParticipants.emit()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-pool-actions-panel"]],inputs:{activePool:"activePool",isCreator:"isCreator"},outputs:{finalize:"finalize",addParticipants:"addParticipants"},decls:7,vars:12,consts:[["class","me-3 btn btn-warning btn-sm",3,"disabled","click",4,"ngIf"],["class","me-3 btn btn-success btn-sm",3,"disabled","click",4,"ngIf"],[1,""],[1,"me-3","btn","btn-warning","btn-sm",3,"disabled","click"],[1,"me-3","btn","btn-success","btn-sm",3,"disabled","click"]],template:function(n,o){1&n&&(t.YNc(0,I,3,4,"button",0),t.YNc(1,S,3,4,"button",1),t.TgZ(2,"span",2),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"span",2),t._uU(6),t.qZA()),2&n&&(t.Q6J("ngIf",!o.activePool.finalized),t.xp6(1),t.Q6J("ngIf",!o.activePool.finalized),t.xp6(2),t.hij("",t.lcZ(4,10,"Status"),": "),t.xp6(2),t.ekj("text-warning","Active"===(null==o.activePool?null:o.activePool.status))("text-success","Filled"===(null==o.activePool?null:o.activePool.status))("text-danger","NoFinalized"===(null==o.activePool?null:o.activePool.status)),t.xp6(1),t.Oqu(null==o.activePool?null:o.activePool.status))},dependencies:[r.O5,u.X$],changeDetection:0}),e})();function D(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"a",22),t.NdJ("click",function(){const c=t.CHM(n).index,P=t.oxw(2);return t.KtG(P.setActivePool(c))}),t._uU(1),t.TgZ(2,"span"),t._uU(3),t.ALo(4,"translate"),t.qZA()()}if(2&e){const n=i.$implicit,o=t.oxw(2);t.ekj("text-bg-danger",!n.finalized)("text-bg-warning",o.isTabActive(n)),t.xp6(1),t.AsE(" ",n.name,"(",n.tokenName,") "),t.xp6(2),t.hij(" ",n.privatable?t.lcZ(4,7,"Private pool"):""," ")}}function F(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"a",23),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.nextPools())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Load more"),"... "))}function Q(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"div",24)(1,"div",25),t._uU(2," Be careful! This operation can only be performed once "),t.qZA(),t.TgZ(3,"div",26),t._UZ(4,"input",27),t.TgZ(5,"button",28),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.saveTokenAddress())}),t._uU(6," Save "),t.qZA(),t.TgZ(7,"button",29),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.cancelEditTokenAddress())}),t._uU(8," Cancel "),t.qZA()()()}if(2&e){const n=t.oxw(2);t.xp6(4),t.ekj("is-invalid",n.editTokenAddressControl.invalid),t.Q6J("formControl",n.editTokenAddressControl),t.xp6(1),t.Q6J("disabled",n.editTokenAddressControl.invalid)}}function q(e,i){1&e&&(t.TgZ(0,"h6",11)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"app-icon",30),t.ALo(5,"translate"),t.qZA()),2&e&&(t.xp6(2),t.hij("",t.lcZ(3,2,"Private pool")," "),t.xp6(2),t.Q6J("toolTipText",t.lcZ(5,4,"PrivatableTipKey")))}function M(e,i){1&e&&(t.TgZ(0,"h6",11)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"app-icon",30),t.ALo(5,"translate"),t.qZA()),2&e&&(t.xp6(2),t.hij("",t.lcZ(3,2,"Approvable pool")," "),t.xp6(2),t.Q6J("toolTipText",t.lcZ(5,4,"ApprovableTipKey")))}function z(e,i){if(1&e&&(t.TgZ(0,"div"),t.YNc(1,M,6,6,"h6",17),t.TgZ(2,"p",12),t._uU(3),t.ALo(4,"translate"),t.qZA()()),2&e){const n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!0),t.xp6(1),t.ekj("text-danger",!(null!=n.activePool&&n.activePool.approved))("text-success",null==n.activePool?null:n.activePool.approved),t.xp6(1),t.hij(" ",t.lcZ(4,6,null!=n.activePool&&n.activePool.approved?"Approved":"Waiting approve")," ")}}function E(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(3);return t.KtG(a.claim())}),t._uU(1," Claim "),t.qZA()}if(2&e){const n=t.oxw().$implicit,o=t.oxw(2);t.Q6J("disabled",!o.canClaim(n))}}function j(e,i){if(1&e&&(t.TgZ(0,"div",31)(1,"h6",32),t._uU(2),t.qZA(),t.TgZ(3,"div",8)(4,"h5",33),t._uU(5," Share/Accrued/Claimed: "),t.TgZ(6,"span"),t._uU(7),t.ALo(8,"number"),t.ALo(9,"number"),t.ALo(10,"number"),t.qZA()(),t.TgZ(11,"div",26),t.YNc(12,E,2,1,"button",34),t.qZA()()()),2&e){const n=i.$implicit,o=t.oxw(2);t.ekj("border-warning",o.isOwner(n)),t.xp6(2),t.hij(" ",n.account," "),t.xp6(5),t.lnq("",t.lcZ(8,7,n.share),"/",t.lcZ(9,9,n.accrued),"/",t.lcZ(10,11,n.claimed),""),t.xp6(5),t.Q6J("ngIf",o.isOwner(n))}}function O(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"div",31)(1,"div",35)(2,"button",36),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.nextParticipants())}),t._uU(3),t.ALo(4,"translate"),t.qZA()()()}if(2&e){const n=t.oxw(2);t.xp6(2),t.Q6J("disabled",n.loading),t.xp6(1),t.hij(" ",t.lcZ(4,2,"Load more")," ")}}function Y(e,i){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"div",1),t.YNc(2,D,5,9,"a",2),t.YNc(3,F,3,3,"a",3),t.qZA(),t.TgZ(4,"div",4)(5,"div",5)(6,"h5",6),t._uU(7),t.qZA(),t.TgZ(8,"app-pool-actions-panel",7),t.NdJ("finalize",function(){t.CHM(n);const a=t.oxw();return t.KtG(a.finalizePool())})("addParticipants",function(){t.CHM(n);const a=t.oxw();return t.KtG(a.onAddParticipants())}),t.qZA()(),t.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"h6",11),t._uU(13,"Pool contract address:"),t.qZA(),t.TgZ(14,"p",12),t._uU(15),t.qZA()(),t.TgZ(16,"div",13)(17,"h6",11),t._uU(18,"Token name:"),t.qZA(),t.TgZ(19,"p",12),t._uU(20),t.qZA()(),t.TgZ(21,"div",13)(22,"h6",11),t._uU(23,"Token amount/filled:"),t.qZA(),t.TgZ(24,"p",12),t._uU(25),t.ALo(26,"number"),t.ALo(27,"number"),t.qZA()()(),t.TgZ(28,"div",9)(29,"div",10)(30,"h6",11),t._uU(31,"Token contract address:"),t.qZA(),t.TgZ(32,"p",14),t._uU(33),t.ALo(34,"translate"),t.TgZ(35,"button",15),t.NdJ("click",function(){t.CHM(n);const a=t.oxw();return t.KtG(a.onEditTokenAddress())}),t._uU(36," Edit "),t.qZA()(),t.YNc(37,Q,9,4,"div",16),t.qZA(),t.TgZ(38,"div",13),t.YNc(39,q,6,6,"h6",17),t.qZA(),t.TgZ(40,"div",13),t.YNc(41,z,5,8,"div",0),t.qZA()(),t.TgZ(42,"div",18)(43,"h6",11),t._uU(44," Participants: "),t.TgZ(45,"span"),t._uU(46),t.qZA()()(),t.TgZ(47,"div",19),t.YNc(48,j,13,13,"div",20),t.YNc(49,O,5,4,"div",21),t.qZA()()(),t.BQk()}if(2&e){const n=t.oxw();t.xp6(2),t.Q6J("ngForOf",n.pools),t.xp6(1),t.Q6J("ngIf",!n.isLastPools),t.xp6(4),t.AsE("# ",null==n.activePool?null:n.activePool.name," (",null==n.activePool?null:n.activePool.tokenName,")"),t.xp6(1),t.Q6J("isCreator",n.isCreator)("activePool",n.activePool),t.xp6(7),t.Oqu(null==n.activePool?null:n.activePool.contractAddress),t.xp6(5),t.Oqu(null==n.activePool?null:n.activePool.tokenName),t.xp6(5),t.AsE(" ",t.lcZ(26,20,null==n.activePool?null:n.activePool.tokenAmount),"/",t.lcZ(27,22,null==n.activePool?null:n.activePool.filledAmount)," "),t.xp6(7),t.ekj("text-danger",!(null!=n.activePool&&n.activePool.tokenAddress)),t.xp6(1),t.hij(" ",null!=n.activePool&&n.activePool.tokenAddress?null==n.activePool?null:n.activePool.tokenAddress:t.lcZ(34,24,"Token address not set")," "),t.xp6(2),t.Q6J("disabled",n.disabledEditTokenAddress),t.xp6(2),t.Q6J("ngIf",n.isEditTokenAddress),t.xp6(2),t.Q6J("ngIf",null==n.activePool?null:n.activePool.privatable),t.xp6(2),t.Q6J("ngIf",n.activePool.approverAddress),t.xp6(5),t.Oqu(null==n.activePool?null:n.activePool.participantsCount),t.xp6(2),t.Q6J("ngForOf",n.prepParticipants(n.participants)),t.xp6(1),t.Q6J("ngIf",!(null!=n.activePool&&n.activePool.privatable)&&!n.isLastParticipants&&n.participants.length)}}let H=(()=>{class e{constructor(){this.tokenAddressChange=new t.vpe,this.claimTokens=new t.vpe,this.nextParticipantsLoad=new t.vpe,this.nextPoolsLoad=new t.vpe,this.activePoolChange=new t.vpe,this.finalize=new t.vpe,this.addParticipants=new t.vpe,this.classes="row",this.editTokenAddressControl=new d.NI("",[d.kI.required,d.kI.pattern(g.Sk)]),this.isEditTokenAddress=!1}get isCreator(){return this.activePool?.adminAddress===this.userAccount}get isLastParticipants(){return this.participants.length>=this.activePool?.participantsCount}get disabledEditTokenAddress(){return!!this.activePool?.tokenAddress||this.isEditTokenAddress||!this.isCreator||!this.activePool.finalized}prepParticipants(n){return(n??[]).sort((o,a)=>o.account===this.userAccount?-1:1)}isOwner(n){return n.account===this.userAccount}canClaim(n){return this.isOwner(n)&&!!n.accrued}onEditTokenAddress(){this.isEditTokenAddress=!0}cancelEditTokenAddress(){this.isEditTokenAddress=!1}saveTokenAddress(){this.tokenAddressChange.emit([this.editTokenAddressControl.value,this.activePool]),this.cancelEditTokenAddress()}isTabActive(n){return this.activePool?.contractAddress===n.contractAddress}setActivePool(n){this.activePoolChange.emit(n)}claim(){this.claimTokens.emit(this.activePool)}nextParticipants(){this.nextParticipantsLoad.emit(this.activePool)}nextPools(){this.nextPoolsLoad.emit()}finalizePool(){this.finalize.emit(this.activePool)}onAddParticipants(){this.addParticipants.emit()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-pools"]],hostVars:2,hostBindings:function(n,o){2&n&&t.Tol(o.classes)},inputs:{pools:"pools",userAccount:"userAccount",activePool:"activePool",loading:"loading",isLastPools:"isLastPools",participants:"participants"},outputs:{tokenAddressChange:"tokenAddressChange",claimTokens:"claimTokens",nextParticipantsLoad:"nextParticipantsLoad",nextPoolsLoad:"nextPoolsLoad",activePoolChange:"activePoolChange",finalize:"finalize",addParticipants:"addParticipants"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"col-2","list-group","list-group-light"],["class","list-group-item list-group-item-action c-pointer",3,"routerLink","text-bg-danger","text-bg-warning","click",4,"ngFor","ngForOf"],["class","list-group-item c-pointer text-center list-group-item-action",3,"routerLink","click",4,"ngIf"],[1,"col-10","card","text-bg-dark","shadow-lg","bg-opacity-75"],[1,"card-header","d-flex"],[1,"m-0"],[1,"ms-auto",3,"isCreator","activePool","finalize","addParticipants"],[1,"card-body"],[1,"row","mb-3"],[1,"col-6"],[1,"card-title"],[1,"card-text"],[1,"col-3"],[1,"card-text","d-flex"],[1,"ms-auto","btn","btn-success","btn-sm",3,"disabled","click"],["class","",4,"ngIf"],["class","card-title",4,"ngIf"],[1,"mb-3"],[1,"d-flex","overflow-auto"],["class","card text-bg-dark me-2 mb-2 w250",3,"border-warning",4,"ngFor","ngForOf"],["class","card text-bg-dark me-2 mb-2 w250",4,"ngIf"],[1,"list-group-item","list-group-item-action","c-pointer",3,"routerLink","click"],[1,"list-group-item","c-pointer","text-center","list-group-item-action",3,"routerLink","click"],[1,""],[1,"text-warning","mb-1"],[1,"d-flex"],[1,"form-control","form-control-sm","bg-dark","text-light","me-2",3,"formControl"],[1,"btn","btn-success","btn-sm","me-2",3,"disabled","click"],[1,"btn","btn-danger","btn-sm",3,"click"],["icon","icon-info-circled",1,"text-warning","ms-1",3,"toolTipText"],[1,"card","text-bg-dark","me-2","mb-2","w250"],[1,"card-header"],[1,"card-title","fs-6","m-0"],["class","ms-auto btn btn-success btn-sm",3,"disabled","click",4,"ngIf"],[1,"card-body","d-flex","align-items-center"],[1,"m-auto","btn","btn-warning","btn-sm","fs-3",3,"disabled","click"]],template:function(n,o){1&n&&t.YNc(0,Y,50,26,"ng-container",0),2&n&&t.Q6J("ngIf",(null==o.pools?null:o.pools.length)&&o.activePool)},dependencies:[r.sg,r.O5,_.rH,d.Fj,d.JJ,d.oH,x.o,N,r.JJ,u.X$],styles:[".list-group[_ngcontent-%COMP%]{--bs-list-group-bg: none;--bs-list-group-color:var(--app-font-light-color);--bs-list-group-action-hover-bg: var(--app-warn-color);--bs-list-group-border-color: var(--app-font-light-color);--bs-list-group-action-hover-color: var(--app-font-dark-color)}"],changeDetection:0}),e})();function G(e,i){if(1&e&&(t.TgZ(0,"p",14),t._uU(1),t.qZA()),2&e){const n=t.oxw(2).ngIf;t.xp6(1),t.hij(" You participated in ",null==n.userPools?null:n.userPools.length," pools ")}}function K(e,i){1&e&&(t.TgZ(0,"p",14),t._uU(1," You have not participated in pools, yet "),t.qZA())}function $(e,i){1&e&&(t.TgZ(0,"p",15),t._uU(1,"You can create new pool"),t.qZA())}function B(e,i){1&e&&(t.TgZ(0,"p",15),t._uU(1," You cannot create new pool while there is not finalized pool "),t.qZA())}function X(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"div",8)(1,"div",9),t.YNc(2,G,2,1,"p",10),t.YNc(3,K,2,0,"p",10),t.TgZ(4,"div",11),t.YNc(5,$,2,0,"p",12),t.YNc(6,B,2,0,"p",12),t.TgZ(7,"button",13),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.showCreatingForm())}),t._uU(8),t.ALo(9,"translate"),t.qZA()()()()}if(2&e){const n=t.oxw().ngIf;t.xp6(2),t.Q6J("ngIf",null==n.userPools?null:n.userPools.length),t.xp6(1),t.Q6J("ngIf",!(null!=n.userPools&&n.userPools.length)),t.xp6(2),t.Q6J("ngIf",n.state.canCreatePool),t.xp6(1),t.Q6J("ngIf",!n.state.canCreatePool),t.xp6(1),t.Q6J("disabled",!n.state.canCreatePool),t.xp6(1),t.hij(" ",t.lcZ(9,6,"Create pool")," ")}}function V(e,i){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-pools",16),t.NdJ("claimTokens",function(a){t.CHM(n);const c=t.oxw(2);return t.KtG(c.claimTokens(a))})("tokenAddressChange",function(a){t.CHM(n);const c=t.oxw(2);return t.KtG(c.tokenAddressChange(a))})("nextParticipantsLoad",function(a){t.CHM(n);const c=t.oxw(2);return t.KtG(c.nextParticipants(a))})("nextPoolsLoad",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.nextPools())})("activePoolChange",function(a){t.CHM(n);const c=t.oxw(2);return t.KtG(c.goToPool(a))})("finalize",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.finalizePool())})("addParticipants",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.showParticipantsForm())}),t.qZA(),t.BQk()}if(2&e){const n=t.oxw().ngIf;t.xp6(1),t.Q6J("pools",n.userPools)("userAccount",n.state.userAccount)("participants",n.state.participants)("activePool",n.localState.activePool)("loading",n.loading)("isLastPools",n.state.isLastPools)}}function W(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"div",26)(1,"button",27),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(3);return t.KtG(a.closeParticipantsForm())}),t.qZA()()}}function R(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"div",17)(1,"div",18)(2,"div",19)(3,"div",20)(4,"h5",15),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.YNc(7,W,2,0,"div",21),t.qZA(),t.TgZ(8,"div",22)(9,"span",7),t._uU(10),t.ALo(11,"translate"),t.ALo(12,"number"),t.qZA(),t.TgZ(13,"div",7)(14,"span"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"span"),t._uU(18),t.ALo(19,"translate"),t.qZA()()()(),t.TgZ(20,"app-participants",23),t.NdJ("participantsChanges",function(a){t.CHM(n);const c=t.oxw(2);return t.KtG(c.onParticipantsChanges(a))})("validnessChanges",function(a){t.CHM(n);const c=t.oxw(2);return t.KtG(c.onValidnessChanges(a))}),t.qZA(),t.TgZ(21,"div",24)(22,"button",25),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.addToPool())}),t._uU(23),t.ALo(24,"translate"),t.qZA()()()()}if(2&e){const n=t.oxw().ngIf,o=t.oxw();t.xp6(5),t.Oqu(t.lcZ(6,14,"Add participant")),t.xp6(2),t.Q6J("ngIf",n.localState.participants.length),t.xp6(3),t.AsE(" ",t.lcZ(11,16,"Token amount"),": ",t.lcZ(12,18,o.tokenAmount(n.localState.participants))," "),t.xp6(4),t.ekj("text-danger",o.isOverParticipants),t.xp6(1),t.AsE(" ",t.lcZ(16,20,"Participant count"),": ",n.localState.participants.length," "),t.xp6(3),t.AsE(" (",t.lcZ(19,22,"Max participants per Ts"),": ",o.MAX_POOL_PARTICIPANTS,") "),t.xp6(2),t.Q6J("readOnly",n.loading)("excludedParticipants",o.mapToAccount(null==n.state?null:n.state.participants)),t.xp6(2),t.Q6J("disabled",!n.localState.participantsValidness||o.isOverParticipants),t.xp6(1),t.hij(" ",t.lcZ(24,24,"Add to pool")," ")}}function tt(e,i){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"app-header",1),t.NdJ("connectWallet",function(){t.CHM(n);const a=t.oxw();return t.KtG(a.connectionService.connect())}),t.qZA(),t.TgZ(2,"main",2),t._UZ(3,"app-notification",3),t.TgZ(4,"div",4),t.YNc(5,X,10,8,"div",5),t.YNc(6,V,2,6,"ng-container",0),t.YNc(7,R,25,26,"div",6),t.TgZ(8,"div",7),t._uU(9),t.ALo(10,"translate"),t.qZA()()(),t.BQk()}if(2&e){const n=i.ngIf;t.xp6(1),t.Q6J("connected",n.state.userConnected)("loading",n.loading),t.xp6(4),t.Q6J("ngIf",n.state.userConnected),t.xp6(1),t.Q6J("ngIf",n.state.userConnected),t.xp6(1),t.Q6J("ngIf",n.localState.showParticipantsForm),t.xp6(2),t.Oqu(t.lcZ(10,6,"AppInfoKey"))}}const nt=function(e,i,n,o){return{state:e,localState:i,userPools:n,loading:o}};let C=(()=>{class e{constructor(n,o,a,c,P){this.connectionService=n,this.stateService=o,this.contractService=a,this.router=c,this.route=P,this.classes="main-layout flex-shrink-0 flex-grow-1",this.state$=this.stateService.state$.pipe((0,b.b)(p=>{})),this.userPools$=this.state$.pipe((0,Z.U)(p=>p.userPools),(0,m.h)(p=>!!p?.length),(0,b.b)(p=>{if(console.log(p),this.localState$.value.activePool){const at=p.find(({contractAddress:it})=>it===this.localState$.value.activePool.contractAddress);this.patchLocalState({activePool:at})}})),this.MAX_POOL_PARTICIPANTS=g.Sd,this.localState$=new k.X({activePool:null,showParticipantsForm:!1,participants:[]}),this.defaultPLoadParams={first:0,size:25,mergeMode:!1},this.defaultPDataLoadParams={first:0,size:50,mergeMode:!1},this.pLoadParams={...this.defaultPLoadParams},this.dLoadParams={...this.defaultPDataLoadParams},this.destroyed$=new L.x}get isOverParticipants(){return this.localState$.value.participants.length>g.Sd}ngOnInit(){var n=this;return(0,l.Z)(function*(){n.state$.pipe((0,m.h)(({userConnected:o})=>o),(0,w.P)()).subscribe(()=>{n.loadData()}),(0,J.a)([n.route.params,n.userPools$]).pipe((0,y.x)(([o],[a])=>o.id===a.id),(0,m.h)(([o,a])=>!!a.length),(0,U.R)(n.destroyed$)).subscribe(([o,a])=>{const c=o.id?+o.id:0;a[c]?n.activePoolChange(a[c]):n.goToPool(0)})})()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}showCreatingForm(){var n=this;return(0,l.Z)(function*(){n.router.navigate(["/new-pool"])})()}tokenAddressChange(n){var o=this;return(0,l.Z)(function*(){yield o.contractService.setTokenContract(n[0],n[1]),yield o.loadData()})()}claimTokens(n){var o=this;return(0,l.Z)(function*(){yield o.contractService.claimToken(n),yield o.loadData()})()}activePoolChange(n){this.patchLocalState({activePool:n}),this.pLoadParams={...this.defaultPLoadParams},this.contractService.dispatchParticipants(n,this.pLoadParams)}goToPool(n){this.router.navigate(["/pools",n])}nextParticipants(n){var o=this;return(0,l.Z)(function*(){o.pLoadParams={...o.pLoadParams,first:o.pLoadParams.first+o.pLoadParams.size,mergeMode:!0},yield o.contractService.dispatchParticipants(n,o.pLoadParams)})()}nextPools(){const n={...this.defaultPDataLoadParams,first:this.dLoadParams.first+this.defaultPDataLoadParams.size,mergeMode:!0};this.loadData(n)}finalizePool(){var n=this;return(0,l.Z)(function*(){yield n.contractService.finalize(),yield n.loadData()})()}showParticipantsForm(){var n=this;return(0,l.Z)(function*(){n.patchLocalState({showParticipantsForm:!0})})()}closeParticipantsForm(){var n=this;return(0,l.Z)(function*(){n.patchLocalState({showParticipantsForm:!1})})()}addToPool(){var n=this;return(0,l.Z)(function*(){yield n.contractService.addParticipants(n.localState$.value.participants),n.patchLocalState({participants:[],showParticipantsForm:!1}),yield n.loadData()})()}onParticipantsChanges(n){this.patchLocalState({participants:n})}onValidnessChanges(n){this.patchLocalState({participantsValidness:n})}mapToAccount(n=[]){return n.map(o=>o.account)}tokenAmount(n){return n.reduce((o,a)=>o+(a.share||0),0)}patchLocalState(n){this.localState$.next({...this.localState$.value,...n})}loadData(n=this.defaultPDataLoadParams){var o=this;return(0,l.Z)(function*(){o.dLoadParams={...o.dLoadParams,...n},yield o.contractService.dispatchPoolsData(o.dLoadParams)})()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(h.Mo),t.Y36(h.O0),t.Y36(h.U3),t.Y36(_.F0),t.Y36(_.gz))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-dashboard"]],hostVars:2,hostBindings:function(n,o){2&n&&t.Tol(o.classes)},decls:5,vars:14,consts:[[4,"ngIf"],[1,"mb-auto",3,"connected","loading","connectWallet"],[1,"pt-3","pb-3"],["id","main"],[1,"container"],["class","dashboard fs-5 mb-3",4,"ngIf"],["class","row justify-content-end",4,"ngIf"],[1,""],[1,"dashboard","fs-5","mb-3"],[1,"row","mb-5"],["class","col m-0 d-flex align-items-center",4,"ngIf"],[1,"d-flex","align-items-center","col","justify-content-end"],["class","m-0",4,"ngIf"],[1,"btn","btn-warning","ms-3","fs-5",3,"disabled","click"],[1,"col","m-0","d-flex","align-items-center"],[1,"m-0"],[1,"mb-3",3,"pools","userAccount","participants","activePool","loading","isLastPools","claimTokens","tokenAddressChange","nextParticipantsLoad","nextPoolsLoad","activePoolChange","finalize","addParticipants"],[1,"row","justify-content-end"],[1,"col-10","card","text-bg-dark","shadow-lg","bg-opacity-75"],[1,"card-header"],[1,"d-flex","justify-content-between","align-items-center"],["class","d-flex align-items-center",4,"ngIf"],[1,"d-flex","justify-content-between"],[1,"card-body",3,"readOnly","excludedParticipants","participantsChanges","validnessChanges"],[1,"card-footer","d-flex","justify-content-end"],[1,"btn","btn-success","fs-5",3,"disabled","click"],[1,"d-flex","align-items-center"],[1,"btn-close","btn-close-white","fs-5",3,"click"]],template:function(n,o){1&n&&(t.YNc(0,tt,11,8,"ng-container",0),t.ALo(1,"async"),t.ALo(2,"async"),t.ALo(3,"async"),t.ALo(4,"async")),2&n&&t.Q6J("ngIf",t.l5B(9,nt,t.lcZ(1,1,o.state$),t.lcZ(2,3,o.localState$),t.lcZ(3,5,o.userPools$),t.lcZ(4,7,o.connectionService.loading$)))},dependencies:[r.O5,f.G,A.c,T.g,H,r.Ov,r.JJ,u.X$],changeDetection:0}),e})();const ot=[{path:"",component:C},{path:":id",component:C}];let et=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[r.ez,f.G,_.Bz.forChild(ot),u.aw,d.UX,x.o,A.c,T.g]}),e})()}}]);