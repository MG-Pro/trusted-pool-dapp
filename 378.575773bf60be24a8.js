"use strict";(self.webpackChunktrusted_pool_dapp=self.webpackChunktrusted_pool_dapp||[]).push([[378],{6378:(R,Z,i)=>{i.r(Z),i.d(Z,{NewPoolModule:()=>H});var d=i(6895),r=i(4006),x=i(4581),A=i(3646),v=i(5019),C=i(5981),b=i(9527),m=i(5861),p=i(8029),N=i(1135),k=i(8505),y=i(4004),w=i(9300),L=i(590),F=i(9841);class U{static splitParticipants(a,e){const n=[];for(let s=0;s<a.length;s+=e){const c=a.slice(s,s+e);n.push(c)}return n}}var t=i(4650),g=i(4976),h=i(9383);let E=(()=>{class o{constructor(){this.nextTs=new t.vpe,this.cancel=new t.vpe,this.classes="card text-bg-dark shadow-lg bg-opacity-75 col-8 "}get buttonText(){switch(this.tsProcessing.currentTs){case 0:return"Create pool";case this.tsProcessing.countTS-1:return"Finalize";default:return"Add participants"}}onNextTs(){this.nextTs.emit()}onCancel(){this.cancel.emit()}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-processing"]],hostVars:2,hostBindings:function(e,n){2&e&&t.Tol(n.classes)},inputs:{tsProcessing:"tsProcessing"},outputs:{nextTs:"nextTs",cancel:"cancel"},decls:20,vars:19,consts:[[1,""],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"card-title","m-0"],[1,"card-body"],[1,"card-subtitle","fs-6","d-flex","align-items-center"],[1,"spinner-border","opacity-50","text-warning","me-3"],[1,"card-footer","d-flex","justify-content-end"],[1,"btn","btn-danger",3,"disabled","click"],["icon","icon-info-circled",1,"text-dark","ms-3",3,"toolTipText"],[1,"btn","btn-warning","ms-3",3,"disabled","click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h5",2),t._uU(3),t.ALo(4,"translate"),t.qZA()(),t.TgZ(5,"div",3)(6,"h6",4),t._UZ(7,"span",5),t._uU(8),t.ALo(9,"translate"),t.qZA()(),t.TgZ(10,"div",6)(11,"button",7),t.NdJ("click",function(){return n.onCancel()}),t.TgZ(12,"span"),t._uU(13),t.ALo(14,"translate"),t.qZA(),t._UZ(15,"app-icon",8),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"button",9),t.NdJ("click",function(){return n.onNextTs()}),t._uU(18),t.ALo(19,"translate"),t.qZA()()()),2&e&&(t.xp6(3),t.lnq(" ",t.lcZ(4,9,"Transaction")," # ",n.tsProcessing.currentTs," / ",n.tsProcessing.countTS," "),t.xp6(5),t.hij("",t.lcZ(9,11,"Processing"),"... "),t.xp6(3),t.Q6J("disabled",n.tsProcessing.pending),t.xp6(2),t.Oqu(t.lcZ(14,13,"Cancel")),t.xp6(2),t.Q6J("toolTipText",t.lcZ(16,15,"Articles.CancelSeparatedPool")),t.xp6(2),t.Q6J("disabled",n.tsProcessing.pending),t.xp6(1),t.hij(" ",t.lcZ(19,17,n.buttonText)," "))},dependencies:[v.o,h.X$],changeDetection:0}),o})();var T=i(4542),I=i(7579),S=i(2722);function O(o,a){if(1&o&&(t.TgZ(0,"div",6)(1,"div",28)(2,"label",8),t._uU(3),t.ALo(4,"translate"),t.TgZ(5,"span",9),t._uU(6,"*"),t.qZA()(),t._UZ(7,"input",29),t.TgZ(8,"p",11),t._uU(9),t.ALo(10,"translate"),t.qZA()(),t.TgZ(11,"div",30)(12,"label",8),t._uU(13),t.ALo(14,"translate"),t.TgZ(15,"span",9),t._uU(16,"*"),t.qZA()(),t._UZ(17,"input",31),t.TgZ(18,"p",11),t._uU(19),t.ALo(20,"translate"),t.qZA()()()),2&o){const e=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,11,"Approver address")," "),t.xp6(4),t.ekj("is-invalid",e.hasErrors("approverAddress")),t.xp6(2),t.Oqu(t.lcZ(10,13,"Address not valid")),t.xp6(4),t.AsE("",t.lcZ(14,15,"Approver`s fee")," ",e.FEE_TOKEN.name," "),t.xp6(4),t.ekj("is-invalid",e.hasErrors("stableApproverFee")),t.xp6(2),t.lnq(" ",t.lcZ(20,17,"Min approver fee is")," ",e.MIN_APPROVER_FEE,"",e.FEE_TOKEN.name," ")}}function J(o,a){if(1&o&&(t.TgZ(0,"div",32)(1,"label",8),t._uU(2),t.ALo(3,"translate"),t.ALo(4,"number"),t.qZA(),t.TgZ(5,"label",8),t._uU(6),t.ALo(7,"translate"),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.AsE("",t.lcZ(3,6,"Token amount"),": ",t.lcZ(4,8,e.tokenAmount)," "),t.xp6(3),t.ekj("text-danger",e.participants.length>e.MAX_POOL_PARTICIPANTS),t.xp6(1),t.AsE("",t.lcZ(7,10,"Participant count"),": ",e.participants.length," ")}}function $(o,a){1&o&&(t.TgZ(0,"p",33),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Please, add at least 1 participant")," "))}const j=function(){return{min:3,max:10}},M=function(){return{min:1,max:10}},q=["*"];let V=(()=>{class o{constructor(e){this.fb=e,this.readOnly=!1,this.participants=[],this.participantsValidness=!1,this.closeForm=new t.vpe,this.createPool=new t.vpe,this.classes="card text-bg-dark shadow-lg bg-opacity-75 col-8",this.form=this.fb.group({name:["",[r.kI.required,r.kI.minLength(3),r.kI.maxLength(10)]],tokenName:["",[r.kI.required,r.kI.minLength(1),r.kI.maxLength(10)]],tokenAddress:["",[T.m.isAddress]],approverAddress:["",[T.m.isAddress,T.m.conditionalRequired(()=>this.form.get("approvable").value)]],stableApproverFee:[p.nM,[r.kI.required,r.kI.min(p.nM)]],approvable:!1,privatable:!1}),this.FEE_TOKEN=p.Ws,this.MIN_APPROVER_FEE=p.nM,this.MAX_POOL_PARTICIPANTS=p.Sd,this.destroyed$=new I.x}get tokenAmount(){return this.participants.reduce((e,n)=>e+(n.share||0),0)}get saveDisabled(){return this.form.invalid||this.form.disabled||!this.participantsValidness}ngOnInit(){this.form.valueChanges.pipe((0,S.R)(this.destroyed$)).subscribe(e=>{this.formData=e}),this.form.get("approvable").valueChanges.pipe((0,S.R)(this.destroyed$)).subscribe(()=>{this.form.get("approverAddress").updateValueAndValidity(),this.form.get("stableApproverFee").updateValueAndValidity()}),this.form.patchValue({name:"VC2",tokenName:"MTG"})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}ngOnChanges(e){e.hasOwnProperty("readOnly")&&(this.readOnly?this.form.disable():this.form.enable())}hasErrors(e){return this.form.get(e).dirty&&this.hasFieldError(e)}onClose(){this.closeForm.emit()}onSave(){this.createPool.emit({...this.formData})}hasFieldError(e){switch(e){case"tokenName":case"name":return this.form.hasError("required",[e])||this.form.hasError("minlength",[e])||this.form.hasError("maxlength",[e]);case"tokenAddress":return this.form.hasError("isAddress",[e]);case"approverAddress":return this.form.hasError("required",[e])||this.form.hasError("isAddress",[e]);case"stableApproverFee":return this.form.hasError("required",[e])||this.form.hasError("min",[e]);default:return!1}}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(r.qu))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-pool-form"]],hostVars:2,hostBindings:function(e,n){2&e&&t.Tol(n.classes)},inputs:{readOnly:"readOnly",participants:"participants",participantsValidness:"participantsValidness"},outputs:{closeForm:"closeForm",createPool:"createPool"},features:[t.TTD],ngContentSelectors:q,decls:64,vars:54,consts:[[1,"",3,"formGroup"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"card-title","m-0"],[1,"btn-close","btn-close-white","fs-5",3,"click"],[1,"card-body"],[1,"card-subtitle","mb-4","fs-6","text-success"],[1,"row","mb-3"],[1,"col"],[1,"form-label"],[1,"text-danger"],["formControlName","name",1,"form-control","bg-dark","text-light","border-opacity-50"],[1,"invalid-feedback","mb-0"],[1,"col","ps-0"],["formControlName","tokenName",1,"form-control","bg-dark","text-light"],[1,"mb-3"],["formControlName","tokenAddress",1,"form-control","bg-dark","text-light"],[1,"mb-3","form-check","form-switch"],["type","checkbox","role","switch","formControlName","approvable",1,"form-check-input","c-pointer"],[1,"form-check-label","d-flex","align-items-center"],["icon","icon-info-circled",1,"text-danger","ms-3",3,"toolTipText"],["class","row mb-3",4,"ngIf"],["type","checkbox","role","switch","formControlName","privatable",1,"form-check-input","c-pointer"],[1,"form-check-label"],["class","mb-3 d-flex justify-content-between",4,"ngIf"],[1,"d-flex","justify-content-end","align-items-center"],[1,"d-flex","justify-content-end","align-items-end"],["class","text-danger m-0 me-3",4,"ngIf"],[1,"btn","btn-success","fs-5",3,"disabled","click"],[1,"col-8"],["formControlName","approverAddress",1,"form-control","bg-dark","text-light"],[1,"col-4","ps-0"],["type","number","formControlName","stableApproverFee",1,"form-control","bg-dark","text-light"],[1,"mb-3","d-flex","justify-content-between"],[1,"text-danger","m-0","me-3"]],template:function(e,n){1&e&&(t.F$t(),t.TgZ(0,"form",0)(1,"div",1)(2,"h5",2),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"button",3),t.NdJ("click",function(){return n.onClose()}),t.qZA()(),t.TgZ(6,"div",4)(7,"h6",5),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"div",6)(11,"div",7)(12,"label",8),t._uU(13),t.ALo(14,"translate"),t.TgZ(15,"span",9),t._uU(16,"*"),t.qZA()(),t._UZ(17,"input",10),t.TgZ(18,"p",11),t._uU(19),t.ALo(20,"translate"),t.qZA()(),t.TgZ(21,"div",12)(22,"label",8),t._uU(23),t.ALo(24,"translate"),t.TgZ(25,"span",9),t._uU(26,"*"),t.qZA()(),t._UZ(27,"input",13),t.TgZ(28,"p",11),t._uU(29),t.ALo(30,"translate"),t.qZA()()(),t.TgZ(31,"div",14)(32,"label",8),t._uU(33),t.ALo(34,"translate"),t.qZA(),t._UZ(35,"input",15),t.TgZ(36,"p",11),t._uU(37),t.ALo(38,"translate"),t.qZA()(),t.TgZ(39,"div",16),t._UZ(40,"input",17),t.TgZ(41,"label",18)(42,"span"),t._uU(43),t.ALo(44,"translate"),t.qZA(),t._UZ(45,"app-icon",19),t.ALo(46,"translate"),t.qZA()(),t.YNc(47,O,21,19,"div",20),t.TgZ(48,"div",16),t._UZ(49,"input",21),t.TgZ(50,"label",22)(51,"span"),t._uU(52),t.ALo(53,"translate"),t.qZA(),t._UZ(54,"app-icon",19),t.ALo(55,"translate"),t.qZA()(),t.YNc(56,J,8,12,"div",23),t.Hsn(57),t.TgZ(58,"div",24)(59,"div",25),t.YNc(60,$,3,3,"p",26),t.TgZ(61,"button",27),t.NdJ("click",function(){return n.onSave()}),t._uU(62),t.ALo(63,"translate"),t.qZA()()()()()),2&e&&(t.Q6J("formGroup",n.form),t.xp6(3),t.Oqu(t.lcZ(4,24,"Creating new pool")),t.xp6(5),t.hij(" ",t.lcZ(9,26,"Please, fill the form for creating new pool")," "),t.xp6(5),t.hij(" ",t.lcZ(14,28,"Pool name")," "),t.xp6(4),t.ekj("is-invalid",n.hasErrors("name")),t.xp6(2),t.hij(" ",t.xi3(20,30,"Input from {min} to {max} symbols",t.DdM(52,j))," "),t.xp6(4),t.hij(" ",t.lcZ(24,33,"Token name")," "),t.xp6(4),t.ekj("is-invalid",n.hasErrors("tokenName")),t.xp6(2),t.hij(" ",t.xi3(30,35,"Input from {min} to {max} symbols",t.DdM(53,M))," "),t.xp6(4),t.hij("",t.lcZ(34,38,"Token address")," "),t.xp6(2),t.ekj("is-invalid",n.hasErrors("tokenAddress")),t.xp6(2),t.Oqu(t.lcZ(38,40,"Address not valid")),t.xp6(6),t.Oqu(t.lcZ(44,42,"Approvable pool")),t.xp6(2),t.Q6J("toolTipText",t.lcZ(46,44,"ApprovableTipKey")),t.xp6(2),t.Q6J("ngIf",n.form.get("approvable").value),t.xp6(5),t.Oqu(t.lcZ(53,46,"Private pool")),t.xp6(2),t.Q6J("toolTipText",t.lcZ(55,48,"PrivatableTipKey")),t.xp6(2),t.Q6J("ngIf",n.participants.length),t.xp6(4),t.Q6J("ngIf",!n.participants.length),t.xp6(1),t.Q6J("disabled",n.saveDisabled),t.xp6(1),t.hij(" ",t.lcZ(63,50,"Create pool")," "))},dependencies:[d.O5,r._Y,r.Fj,r.wV,r.Wl,r.JJ,r.JL,r.sg,r.u,v.o,d.JJ,h.X$],changeDetection:0}),o})();function Q(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"app-processing",9),t.NdJ("nextTs",function(){t.CHM(e);const s=t.oxw(3);return t.KtG(s.onNextTs())})("cancel",function(){t.CHM(e);const s=t.oxw(3);return t.KtG(s.onCancelTs())}),t.qZA()}if(2&o){const e=t.oxw(2).ngIf;t.Q6J("tsProcessing",e.tsProcessing)}}function D(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"div",5),t.YNc(1,Q,1,1,"app-processing",6),t.TgZ(2,"app-pool-form",7),t.NdJ("closeForm",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.onCloseForm())})("createPool",function(s){t.CHM(e);const c=t.oxw(2);return t.KtG(c.onCreate(s))}),t.TgZ(3,"app-participants",8),t.NdJ("participantsChanges",function(s){t.CHM(e);const c=t.oxw(2);return t.KtG(c.onParticipantsChanges(s))})("validnessChanges",function(s){t.CHM(e);const c=t.oxw(2);return t.KtG(c.onParticipantsValidness(s))}),t.qZA()()()}if(2&o){const e=t.oxw().ngIf;t.xp6(1),t.Q6J("ngIf",e.tsProcessing.active),t.xp6(1),t.Q6J("readOnly",e.isFormDisabled)("participants",e.localState.participants)("participantsValidness",e.localState.participantsValidness)}}function Y(o,a){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-header",1),t.NdJ("connectWallet",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.connectionService.connect())}),t.qZA(),t.TgZ(2,"main",2),t._UZ(3,"app-notification",3),t.YNc(4,D,4,4,"div",4),t.qZA(),t.BQk()}if(2&o){const e=a.ngIf;t.xp6(1),t.Q6J("connected",e.state.userConnected)("loading",e.loading),t.xp6(3),t.Q6J("ngIf",e.initialized)}}const K=function(o,a,e,n,s,c){return{state:o,tsProcessing:a,initialized:e,isFormDisabled:n,localState:s,loading:c}},G=[{path:"",component:(()=>{class o{constructor(e,n,s,c,u,f,P){this.connectionService=e,this.stateService=n,this.modalService=s,this.translate=c,this.router=u,this.contractService=f,this.scroller=P,this.classes="main-layout flex-shrink-0 flex-grow-1",this.localState$=new N.X({participants:[],formDisabled:!1,participantsValidness:!1}),this.tsProcessing$=new N.X({active:!1,pending:!1,currentTs:0,countTS:0,tsCalls:[]}),this.state$=this.stateService.state$.pipe((0,k.b)(l=>{})),this.initialized$=this.state$.pipe((0,y.U)(l=>!(l.initialized&&!l.userConnected&&(this.router.navigate(["/pools"]),1))),(0,w.h)(l=>l),(0,L.P)()),this.isFormDisabled$=(0,F.a)([this.state$,this.localState$]).pipe((0,y.U)(([l,{formDisabled:_}])=>!l.canCreatePool&&_)),this.MAX_POOL_PARTICIPANTS=p.Sd}onCreate(e){var n=this;return(0,m.Z)(function*(){const s=n.localState$.value.participants;if(s.length>p.Sd)return n.modalService.open([n.translate.instant("MaxPoolParticipantTsKey",{max:p.Sd,tsCount:Math.ceil(s.length/p.Sd)})]).result.then(()=>{n.createSplittedPool(e,s)}).catch(()=>{});e.finalized=!0,yield n.contractService.createNewPool(e,s),n.goToPool()})()}onCloseForm(){this.goToPool()}onNextTs(){this.processingNextCall()}onCancelTs(){const{currentTs:e}=this.tsProcessing$.value;this.processingStop(),this.patchLocalState({formDisabled:!1}),e>0&&this.goToPool()}onParticipantsValidness(e){this.patchLocalState({participantsValidness:e})}onParticipantsChanges(e){this.patchLocalState({participants:e})}goToPool(){const{length:e}=this.stateService.value.userPools;this.router.navigate(["/pools",e>0?e-1:""])}createSplittedPool(e,n){var s=this;return(0,m.Z)(function*(){s.patchLocalState({formDisabled:!0}),s.scroller.scrollToPosition([0,0]);const c=U.splitParticipants(n,s.MAX_POOL_PARTICIPANTS),[u,...f]=c,P=c.length+1,l=[];l.push((0,m.Z)(function*(){return yield s.contractService.createNewPool({...e,finalized:!1},u)}));for(const _ of f)l.push((0,m.Z)(function*(){return yield s.contractService.addParticipants(_)}));l.push((0,m.Z)(function*(){return yield s.contractService.finalize()})),s.processingSetQueue({tsCalls:l,countTS:P,currentTs:0,active:!0,pending:!1})})()}processingSetQueue(e){this.patchProcessing(e)}processingNextCall(){var e=this;return(0,m.Z)(function*(){const{currentTs:n,countTS:s,tsCalls:c}=e.tsProcessing$.value,u=n+1;e.patchProcessing({pending:!0}),(yield c[n]())?(e.patchProcessing({currentTs:u,pending:!1}),u>=s&&(e.processingStop(),e.goToPool())):e.patchProcessing({pending:!1})})()}patchProcessing(e){this.tsProcessing$.next({...this.tsProcessing$.value,...e})}patchLocalState(e){this.localState$.next({...this.localState$.value,...e})}processingStop(){this.patchProcessing({active:!1,pending:!1,currentTs:0,countTS:0,tsCalls:[]})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(g.Mo),t.Y36(g.O0),t.Y36(g.Z7),t.Y36(h.sK),t.Y36(x.F0),t.Y36(g.U3),t.Y36(d.EM))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-new-pool"]],hostVars:2,hostBindings:function(e,n){2&e&&t.Tol(n.classes)},decls:7,vars:20,consts:[[4,"ngIf"],[1,"mb-auto",3,"connected","loading","connectWallet"],[1,"pt-3","pb-3"],["id","main"],["class","container d-flex flex-column align-items-center",4,"ngIf"],[1,"container","d-flex","flex-column","align-items-center"],["class","mb-3",3,"tsProcessing","nextTs","cancel",4,"ngIf"],[3,"readOnly","participants","participantsValidness","closeForm","createPool"],[3,"participantsChanges","validnessChanges"],[1,"mb-3",3,"tsProcessing","nextTs","cancel"]],template:function(e,n){1&e&&(t.YNc(0,Y,5,3,"ng-container",0),t.ALo(1,"async"),t.ALo(2,"async"),t.ALo(3,"async"),t.ALo(4,"async"),t.ALo(5,"async"),t.ALo(6,"async")),2&e&&t.Q6J("ngIf",t.HTZ(13,K,t.lcZ(1,1,n.state$),t.lcZ(2,3,n.tsProcessing$),t.lcZ(3,5,n.initialized$),t.lcZ(4,7,n.isFormDisabled$),t.lcZ(5,9,n.localState$),t.lcZ(6,11,n.connectionService.loading$)))},dependencies:[d.O5,A.G,C.c,b.g,E,V,d.Ov],changeDetection:0}),o})()}];let H=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[d.ez,x.Bz.forChild(G),A.G,h.aw,r.UX,v.o,C.c,b.g]}),o})()}}]);